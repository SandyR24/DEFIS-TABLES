
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>D√©fi Tables - Sacado Acad√©mie</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f6f6ff;
      color: #333;
    }
    .hidden { display: none; }
    header {
      background: #a88ad2;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
    }
    header img.logo { height: 40px; }
    header img.dogbot { height: 60px; }
    header h1 { color: white; font-size: 1.5rem; margin: 0; }
    main {
      max-width: 600px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    footer {
      text-align: center;
      padding: 20px;
      background: #a88ad2;
      color: white;
    }
    .question { font-size: 2rem; text-align: center; margin: 20px 0; }
    .feedback { font-weight: bold; text-align: center; margin-top: 10px; }
    .correct { color: #27ae60; }
    .wrong { color: #e74c3c; }
    .recap-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .recap-table th, .recap-table td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    .recap-table th { background-color: #a88ad2; color: white; }
    body.dark-mode {
      background-color: #121212;
      color: #f0f0f0;
    }
    body.dark-mode main {
      background-color: #1e1e1e;
      color: #f0f0f0;
    }
    body.dark-mode input,
    body.dark-mode select {
      background-color: #2a2a2a;
      color: #f0f0f0;
    }
    body.dark-mode .recap-table th {
      background-color: #5555aa;
    }
  
@import url('https://fonts.googleapis.com/css2?family=OpenDyslexic&display=swap');

body.dys-font {
  font-family: 'OpenDyslexic', sans-serif;
}


@import url('https://fonts.googleapis.com/css2?family=Lexend+Deca&display=swap');

body.lexend-font {
  font-family: 'Lexend Deca', sans-serif;
}

</style>
</head>
<body>
  <header>
    <img src="sacadoLogo.png" class="logo" alt="Logo Sacado" />
    <h1>Sacado Acad√©mie</h1>
    <img src="dogbot.png" class="dogbot" alt="DogBot" />
  </header>
  <main>
    <div id="parametres">
      <h2>üéØ D√©fi Tables</h2>
      <p><strong>Choisis les tables :</strong></p>
      <div class="checkboxes">
        <label><input type="checkbox" value="2"> 2</label>
        <label><input type="checkbox" value="3"> 3</label>
        <label><input type="checkbox" value="4"> 4</label>
        <label><input type="checkbox" value="5"> 5</label>
        <label><input type="checkbox" value="6"> 6</label>
        <label><input type="checkbox" value="7"> 7</label>
        <label><input type="checkbox" value="8"> 8</label>
        <label><input type="checkbox" value="9"> 9</label>
        <label><input type="checkbox" value="10"> 10</label>
      </div>
      <p><strong>D√©lai :</strong>
        <select id="delai">
          <option value="0">Pas de limite</option>
          <option value="3">3s</option>
          <option value="5">5s</option>
          <option value="10">10s</option>
        </select>
      </p>
      <p><label><input type="checkbox" id="audio"> üîà Lecture audio des questions</label></p>
      <p><strong>Nombre de questions :</strong>
        <select id="nombre">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="15">15</option>
          <option value="20">20</option>
        </select>
      </p>
      <p><label></label><br><label for="font-select">Police lisible :</label> <select id="font-select"><option value="">Standard</option><option value="dys-font">OpenDyslexic</option><option value="lexend-font">Lexend Deca</option></select><br><label><input type="checkbox" id="dysmode"> üåô Mode visuel dys</label></p>
      <button onclick="lancerDefi()">Lancer le d√©fi</button>
    </div>

    <div id="jeu" class="hidden">
      <div id="compteur"></div>
<div id="progressbar" style="height: 10px; background: #a88ad2; width: 100%; transition: none;"></div>
      <div class="question" id="question"></div>
      <input type="number" id="reponse" placeholder="Ta r√©ponse" />
      <button onclick="validerReponse()">Valider</button> <button id="btn-stop" onclick="arreterDefi()">‚èπÔ∏è Arr√™ter</button>
      <div class="feedback" id="feedback"></div>
    </div>

    <div id="resultat" class="hidden result"></div>
  </main>
  <footer>
    ¬© 2025 Sacado - D√©fi Tables
  </footer>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  const champ = document.getElementById("reponse");
  if (champ) {
    champ.addEventListener("keydown", (e) => {
      if (e.key === "Enter") validerReponse();
    });
  }
  
  const dysFont = document.getElementById("dysfont");
  if (dysFont) {
    dysFont.addEventListener("change", () => {
      document.body.classList.toggle("dys-font", dysFont.checked);
    });
  }

  
  const fontSelect = document.getElementById("font-select");
  if (fontSelect) {
    fontSelect.addEventListener("change", () => {
      document.body.classList.remove("dys-font", "lexend-font");
      if (fontSelect.value) {
        document.body.classList.add(fontSelect.value);
      }
    });
  }

  const dysToggle = document.getElementById("dysmode");
  if (dysToggle) {
    dysToggle.addEventListener("change", () => {
      document.body.classList.toggle("dark-mode", dysToggle.checked);
    });
  }
});

function lireQuestion(q) {
  const audioChecked = document.getElementById("audio")?.checked;
  if (!audioChecked || !window.speechSynthesis) return;
  const utterance = new SpeechSynthesisUtterance(`${q.a} fois ${q.b}`);
  utterance.lang = "fr-FR";
  speechSynthesis.speak(utterance);
}

let questions = [], index = 0, score = 0, timer = null, recap = [];

function lancerDefi() {
  const tables = Array.from(document.querySelectorAll('.checkboxes input:checked')).map(cb => parseInt(cb.value));
  const nombre = parseInt(document.getElementById('nombre').value);
  const delai = parseInt(document.getElementById('delai').value);
  if (tables.length === 0) {
    alert("Choisis au moins une table !");
    return;
  }
  const combinaisons = new Set();
  questions = [];
  let tries = 0;
  while (questions.length < nombre && tries < 1000) {
    const a = tables[Math.floor(Math.random() * tables.length)];
    const b = Math.floor(Math.random() * 10) + 1;
    const key = `${Math.min(a,b)}x${Math.max(a,b)}`;
    tries++; 
    if (!combinaisons.has(key)) {
      combinaisons.add(key);
      questions.push({ a, b, produit: a * b });
    }
  }

  index = 0; score = 0; recap = [];
  document.getElementById('parametres').classList.add('hidden');
  document.getElementById('jeu').classList.remove('hidden');
  document.getElementById('resultat').classList.add('hidden');
  afficherQuestion(delai);
}

function demarrerChrono(delai) {
  const bar = document.getElementById('progressbar');
  if (!bar || delai <= 0) return;
  bar.style.transition = 'none';
  bar.style.width = '100%';
  setTimeout(() => {
    bar.style.transition = `width ${delai}s linear`;
    bar.style.width = '0%';
  }, 50);
}

function afficherQuestion(delai) {
  const q = questions[index];
  document.getElementById('question').textContent = `${q.a} √ó ${q.b} = ?`;
  document.getElementById('reponse').value = '';
  document.getElementById('reponse').focus();
  lireQuestion(q);
  document.getElementById('feedback').textContent = '';
  document.getElementById('compteur').textContent = `Question ${index + 1} sur ${questions.length}`;
  demarrerChrono(delai);
  if (delai > 0) {
    clearTimeout(timer);
    timer = setTimeout(() => validerReponse(true), delai * 1000);
  }
}

function validerReponse(forceTemps = false) {
  const q = questions[index];
  const inputVal = document.getElementById('reponse').value;
  const userInput = inputVal === '' ? null : parseInt(inputVal);
  clearTimeout(timer);
  const feedback = document.getElementById('feedback');
  let success = false;
  if (userInput === q.produit && !forceTemps) {
    feedback.textContent = "‚úÖ Bravo !";
    feedback.className = "feedback correct";
    score++;
    success = true;
  } else {
    feedback.textContent = `‚ùå Rat√© ! La bonne r√©ponse √©tait ${q.produit}`;
    feedback.className = "feedback wrong";
  }
  recap.push({
    question: `${q.a} √ó ${q.b}`,
    attendu: q.produit,
    reponse: forceTemps ? "Temps √©coul√©" : (userInput === null || isNaN(userInput) ? "pas de r√©ponse" : userInput),
    correct: success
  });
  index++;
  setTimeout(() => index < questions.length ? afficherQuestion(parseInt(document.getElementById('delai').value)) : afficherResultat(), 1000);
}

function afficherResultat() {
  document.getElementById('jeu').classList.add('hidden');
  const res = document.getElementById('resultat');
  res.classList.remove('hidden');
  let html = `<h2>üéâ Fin du d√©fi !</h2><p>Tu as obtenu <strong>${score}</strong> bonne(s) r√©ponse(s) sur ${recap.length}.</p>`;
  html += '<table class="recap-table"><thead><tr><th>#</th><th>Op√©ration</th><th>R√©ponse √©l√®ve</th><th>Correction</th></tr></thead><tbody>';
  recap.forEach((r, i) => {
    html += `<tr><td>${i+1}</td><td>${r.question}</td><td class="${r.correct ? 'correct' : 'wrong'}">${r.reponse}</td><td>${r.attendu}</td></tr>`;
  });
  html += '</tbody></table><button onclick="location.reload()">Rejouer</button>';
  res.innerHTML = html;
}
  </script>
</body>
</html>

<script>
function arreterDefi() {
  if (confirm("Es-tu s√ªr de vouloir arr√™ter le d√©fi ?")) {
    afficherResultat();
  }
}
</script>
</body>
</html>
